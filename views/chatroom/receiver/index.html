<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
        <title>HiLives活動螢幕</title>
        <link rel="icon" type="image/x-icon" href="/admin/assets/dist/favicon.svg">

        <meta name="application-name" content="HiLives">

        <link rel="canonical" href="https://event.hilives.net" />

        <!-- Main Style -->
        <link rel="stylesheet" href="/admin/assets/partyscreen/css/party-screen.css?ver=HILIVES-20240705">
        
        <!-- Jquery -->
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        
        <!-- sweetalert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <!-- QRcode -->
        <script src="/admin/assets/dist/js/qr-code-styling.js"></script>

        <!-- Anime.js -->
        <script src="/admin/assets/dist/js/anime.min.js"></script>

        <script src="https://unpkg.com/@esotericsoftware/spine-player@4.0/dist/iife/spine-player.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/@esotericsoftware/spine-player@4.0/dist/spine-player.css">
        
        <!-- Party Info Parameter -->
        <script src="/admin/assets/partyscreen/js/party-settings.js?ver=HILIVES-20240705"></script>
        <script>

            let randomCode = ""
            for(let i = 0; i < 20; i++){
                randomCode += getRandomChar()
            }

            const partyID = getKeyFromURL("activity_id")

            const partyName = "{{.ActivityModel.ActivityName}}"

            const qrcodeSettings = {
                logoImg: "{{.ActivityModel.QRcodeLogoPicture}}",
                qrHideDots: "{{.ActivityModel.QRcodePicturePoint}}",
                logoSize: "{{.ActivityModel.QRcodeLogoSize}}",
                logoMargin: "{{.ActivityModel.QRcodeWhiteDistance}}",
                qrDotsColor: "{{.ActivityModel.QRcodePointColor}}",
                qrBgColor: "{{.ActivityModel.QRcodeBackgroundColor}}",
            }

            const pageInfo = [
                { name: "message", enName: "message", zhName: "訊息區", type: "chat", status: "{{.ActivityModel.OverviewMessage}}" },
                { name: "topic", enName: "theme", zhName: "主題區", type: "chat", status: "{{.ActivityModel.OverviewTopic}}" },
                { name: "question", enName: "question", zhName: "提問區", type: "chat", status: "{{.ActivityModel.OverviewQuestion}}" },
                { name: "general", enName: "normalcheckin", zhName: "一般簽到", type: "chat", status: "{{.ActivityModel.OverviewGeneral}}" },
                { name: "threed", enName: "checkin3D", zhName: "3D簽到", type: "chat", status: "{{.ActivityModel.OverviewThreed}}" },
                { name: "signname", enName: "signname", zhName: "簽名牆", type: "chat", status: "{{.ActivityModel.OverviewSignname}}" },
                { name: "redpack", enName: "redpack", zhName: "搖紅包", type: "game", status: "{{.ActivityModel.OverviewRedpack}}" },
                { name: "ropepack", enName: "ropepack", zhName: "套紅包", type: "game", status: "{{.ActivityModel.OverviewRopepack}}" },
                { name: "draw_numbers", enName: "draw_numbers", zhName: "搖號抽獎", type: "game", status: "{{.ActivityModel.OverviewDrawNumbers}}" },
                { name: "lottery", enName: "lottery", zhName: "遊戲抽獎", type: "game", status: "{{.ActivityModel.OverviewLottery}}" },
                { name: "bingo", enName: "bingo", zhName: "賓果抽獎", type: "game", status: "{{.ActivityModel.OverviewBingo}}" },
                { name: "whack_mole", enName: "whack_mole", zhName: "敲敲樂", type: "game", status: "{{.ActivityModel.OverviewWhackMole}}" },
                { name: "monopoly", enName: "monopoly", zhName: "鑑定師", type: "game", status: "{{.ActivityModel.OverviewMonopoly}}" },
                { name: "QA", enName: "QA", zhName: "快問快答", type: "game", status: "{{.ActivityModel.OverviewQA}}" },
                { name: "tugofwar", enName: "tugofwar", zhName: "拔河遊戲", type: "game", status: "{{.ActivityModel.OverviewTugofwar}}" },
            ]

            const pageSetting = {
                message: {
                    qrurl: "{{.Route.ApplySign}}",
                    titleColor: "{{.ActivityModel.MessageScreenTitleColor}}",
                    titleBorderColor: "{{.ActivityModel.MessageScreenTitleFrameColor}}",
                },
                theme: {
                    qrurl: "{{.Route.ApplySign}}",
                    background: "{{.ActivityModel.TopicBackground}}"
                },
                question: { iframeurl: "{{.Route.Question}}", qrurl: "{{.Route.ApplySign}}", },
                normalcheckin: { iframeurl: "{{.Route.General}}", qrurl: "{{.Route.ApplySign}}", },
                checkin3D: { iframeurl: "{{.Route.Threed}}", qrurl: "{{.Route.ApplySign}}", },
                signname: { iframeurl: "{{.Route.Signname}}", qrurl: "{{.Route.SignnameQRcode}}", },
                shakeredpack: { iframeurl: "{{.Route.Redpack}}", qrurl: "{{.Route.RedpackQRcode}}", },
                clickredpack: { iframeurl: "{{.Route.Ropepack}}", qrurl: "{{.Route.RopepackQRcode}}", },
                whackamole: { iframeurl: "{{.Route.WhackMole}}", qrurl: "{{.Route.WhackMoleQRcode}}", },
                drawnumbers: { iframeurl: "{{.Route.DrawNumbers}}", qrurl: "{{.Route.ApplySign}}", },
                lottery: { iframeurl: "{{.Route.Lottery}}", qrurl: "{{.Route.LotteryQRcode}}", },
                bingo: { iframeurl: "{{.Route.Bingo}}", qrurl: "{{.Route.BingoQRcode}}", },
                monopoly: { iframeurl: "{{.Route.Monopoly}}", qrurl: "{{.Route.MonopolyQRcode}}", zhName: "鑑定師", },
                QandA: { iframeurl: "{{.Route.QA}}", qrurl: "{{.Route.QAQRcode}}", },
                tugofwar: { iframeurl: "{{.Route.Tugofwar}}", qrurl: "{{.Route.TugofwarQRcode}}", }
            }

            const chatSetting = {
                normalmessage: {
                    status: "open", //{{.ActivityModel.OverviewMessage}}
                    loopSecond: "{{.ActivityModel.MessageRefreshSecond}}",
                    messageColor: "{{.ActivityModel.MessageTextColor}}",
                    messageBorderColor: "{{.ActivityModel.MessageTextFrameColor}}",
                    messageBoxColor: "{{.ActivityModel.MessageFrameColor}}",
                },
                normalbarrage: {
                    status: "open",
                    loop: "{{.ActivityModel.DanmuLoop}}",
                    top: "{{.ActivityModel.DanmuTop}}",
                    mid: "{{.ActivityModel.DanmuMid}}",
                    btm: "{{.ActivityModel.DanmuBottom}}",
                    name: "{{.ActivityModel.DanmuDisplayName}}",
                    avatar: "{{.ActivityModel.DanmuDisplayAvatar}}",
                    size: "{{.ActivityModel.DanmuSize}}",
                    speed: "{{.ActivityModel.DanmuSpeed}}",
                    density: "{{.ActivityModel.DanmuDensity}}",
                    opacity: "{{.ActivityModel.DanmuOpacity}}",
                },
                specialbarrage: {
                    status: "{{.ActivityModel.OverviewSpecialDanmu}}",
                },
                occupybarrage: {
                    status: "{{.ActivityModel.OverviewHoldscreen}}",
                    second: "{{.ActivityModel.HoldscreenDisplaySecond}}",
                },
            }
            
        </script>

        <!-- Main Script -->
        <script src="/admin/assets/partyscreen/js/occupybarrage.js?ver="></script>

    </head>
    <body>

        <!-- 活動畫面載入緩衝動畫 -->
        <div id="loading-container">
            <img src="/admin/assets/partyscreen/loading-background.png" />
            <svg class="logo-animation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
                <g class="line line-7">
                    <path d="M179,71.6a4.28,4.28,0,0,0-4.6,4V93.2a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V76A4.62,4.62,0,0,0,179,71.6Z" style="fill:#3891a6;fill-rule:evenodd"/>
                    <path d="M178.7,135.4A10.64,10.64,0,0,1,167.8,125a3.5,3.5,0,0,1,7,0,3.7,3.7,0,0,0,3.9,3.4,3.63,3.63,0,0,0,3.9-3.4,3.7,3.7,0,0,0-3.9-3.4c-5.4,0-9.8-4.1-9.8-9.1s4.4-9.1,9.8-9.1c5.1,0,7.5,2.1,9.6,5.4a3.48,3.48,0,0,1-5.9,3.7c-1.1-1.7-1.5-2.1-3.6-2.1-1.5,0-2.8,1-2.8,2.1s1.3,2.1,2.8,2.1A10.64,10.64,0,0,1,189.7,125C189.7,130.8,184.7,135.4,178.7,135.4Z" style="fill:#fafafa"/>
                    <path d="M179,141.2a4.28,4.28,0,0,0-4.6,4v17.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V145.6A4.62,4.62,0,0,0,179,141.2Z" style="fill:#3891a6;fill-rule:evenodd"/>
                </g>
                <g class="line line-6">
                    <path d="M149,64.6a4.28,4.28,0,0,0-4.6,4V86.2a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V69A4.62,4.62,0,0,0,149,64.6Z" style="fill:#20a39e;fill-rule:evenodd"/>
                    <path d="M159.6,122.6c-3.6-1.9-4.1,1.1-4.9,5.5s-10.7,8.1-11.5-9.1h14.3a4.59,4.59,0,0,0,4.6-4.6V114c-.4-6-2.7-15.2-12.6-15.2-14.6,0-14.9,25.5-9.5,34.2s12.1,8.1,16.5,4S163.3,124.5,159.6,122.6Zm-9.6-16c4.3,0,4.8,4.7,4.8,4.7H144.4s1.3-4.7,5.6-4.7Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M148.7,149.2a4.42,4.42,0,0,0-4.6,4v17.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V153.6A4.53,4.53,0,0,0,148.7,149.2Z" style="fill:#20a39e;fill-rule:evenodd"/>
                </g>
                <g class="line line-5">
                    <path d="M115.4,90.3a4.53,4.53,0,0,0,4.1-4.4V68.7a4.36,4.36,0,0,0-8.7-.4V86a4.35,4.35,0,0,0,4.4,4.3Z" style="fill:#c5283d;fill-rule:evenodd"/>
                    <path d="M124.9,98.7a4.37,4.37,0,0,0-5.3,3.1h0l-4.3,16.7-4-16.8a4.32,4.32,0,1,0-8.4,2h0l7.9,33.6a4.14,4.14,0,0,0,2.9,3.1l.4.1a4.37,4.37,0,0,0,5.3-3.1L128,104a4.32,4.32,0,0,0-3.1-5.3Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M115.4,149.2a4.42,4.42,0,0,0-4.6,4v17.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V153.6A4.46,4.46,0,0,0,115.4,149.2Z" style="fill:#c5283d;fill-rule:evenodd"/>
                </g>
                <g class="line line-4">
                    <path d="M90.4,35.9a4.53,4.53,0,0,0,4.1-4.4V14.4A4.46,4.46,0,0,0,90.4,10a4.28,4.28,0,0,0-4.6,4V31.6a4.27,4.27,0,0,0,4.3,4.3Z" style="fill:#e9724c;fill-rule:evenodd"/>
                    <circle cx="89.9" cy="56.5" r="12.2" style="fill:#fafafa"/>
                    <circle cx="89.9" cy="56.5" r="4.3" style="fill:#ff4242"/>
                    <path d="M90.4,78.8a4.43,4.43,0,0,0-4.6,4.1v64.4a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4v-64A4.46,4.46,0,0,0,90.4,78.8Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M90.4,160a4.43,4.43,0,0,0-4.6,4.1v17.6a4.33,4.33,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V164.4A4.53,4.53,0,0,0,90.4,160Z" style="fill:#e9724c;fill-rule:evenodd"/>
                </g>
                <g class="line line-3">
                    <path d="M65.3,28.4A4.46,4.46,0,0,0,69.4,24V6.9a4.36,4.36,0,0,0-8.7-.4V24.1A4.27,4.27,0,0,0,65,28.4Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                    <path d="M73.4,154.1h-4V41.1a4.46,4.46,0,0,0-4.1-4.4,4.28,4.28,0,0,0-4.6,4v118a4.53,4.53,0,0,0,4.4,4.1h8.3a4.27,4.27,0,0,0,4.3-4.3v-.3A4.37,4.37,0,0,0,73.4,154.1Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M65.2,171.6a4.42,4.42,0,0,0-4.6,4v17.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V176A4.53,4.53,0,0,0,65.2,171.6Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                </g>
                <g class="line line-2">
                    <path d="M48.7,10.9a4.42,4.42,0,0,0-4.6,4V32.5a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V15.3A4.46,4.46,0,0,0,48.7,10.9Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                    <path d="M48.6,46A4.43,4.43,0,0,0,44,50.1v7.1a4.27,4.27,0,0,0,4.3,4.3h.3a4.37,4.37,0,0,0,4-4.4V50.5A4.39,4.39,0,0,0,48.6,46Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M48.6,68A4.43,4.43,0,0,0,44,72.1v75.2a4.27,4.27,0,0,0,4.3,4.3h.3a4.37,4.37,0,0,0,4-4.4V72.4A4.37,4.37,0,0,0,48.6,68Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M48.6,159.7a4.43,4.43,0,0,0-4.6,4.1v17.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.37,4.37,0,0,0,4-4.4V164.2A4.39,4.39,0,0,0,48.6,159.7Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                </g>
                <g class="line line-1">
                    <path d="M23.1,69.6a4.53,4.53,0,0,0,4.1-4.4V48a4.35,4.35,0,0,0-8.7-.3V65.2a4.27,4.27,0,0,0,4.3,4.3C23,69.6,23,69.6,23.1,69.6Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                    <path d="M31.4,77.9a4.42,4.42,0,0,0-4.6,4v23.2H19V82.3a4.46,4.46,0,0,0-4.1-4.4,4.42,4.42,0,0,0-4.6,4v54.6a4.27,4.27,0,0,0,4.3,4.3h.3a4.53,4.53,0,0,0,4.1-4.4V113.8h7.8v22.7a4.27,4.27,0,0,0,4.3,4.3h.3a4.37,4.37,0,0,0,4-4.4V82.3A4.37,4.37,0,0,0,31.4,77.9Z" style="fill:#fafafa;fill-rule:evenodd"/>
                    <path d="M23.1,149.2a4.43,4.43,0,0,0-4.6,4.1v17.6a4.33,4.33,0,0,0,4.3,4.3H23a4.53,4.53,0,0,0,4.1-4.4V153.7A4.32,4.32,0,0,0,23.1,149.2Z" style="fill:#ffbd00;fill-rule:evenodd"/>
                </g>
            </svg>
            <h3 class="susscess">
                歡迎進入活動聊天室
            </h3>
            <h3 class="fail">
                連接失敗，請檢查網路訊號是否異常
                <p>如有其它問題，請聯絡專線: 0985939906</p>
            </h3>
            <h3 class="loading">
                <span class="dot dot-1">·</span>
                <span class="dot dot-2">·</span>
                <span class="dot dot-3">·</span>
                <span class="msg">努力載入活動中</span>
                <span class="dot dot-4">·</span>
                <span class="dot dot-5">·</span>
                <span class="dot dot-6">·</span>
            </h3>
        </div>
	
        <!-- 主要畫面區塊 -->
        <div id="main-container">
            <div id="guide-tour">
                <div id="menubartoggle-tour" class="guide-tour-modal">
                    <div class="row-group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-square-fill" viewBox="0 0 16 16">
                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.93 4.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                        </svg>
                        <p>點擊按鈕後能自動 隱藏/顯示 導覽列</p>
                    </div>
                    <div class="control-box">
                        <button>下一步</button>
                    </div>
                </div>
                <div id="helpbutton-tour" class="guide-tour-modal d-none">
                    <div class="row-group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-square-fill" viewBox="0 0 16 16">
                            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm8.93 4.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                        </svg>
                        <p>點擊 「幫助」 按鈕後能更清楚了解各區塊的功能</p>
                    </div>
                    <div class="check-box">
                        <input id="tour-again" type="checkbox" value="false" />
                        <label for="tour-again">之後不再顯示</label>
                    </div>
                    <div class="control-box">
                        <button>我知道了</button>
                    </div>
                    <div class="point"></div>
                </div>
            </div>
            <!-- 活動背景 -->
            <img id="main-background" src="{{.ActivityModel.MessageBackground}}">
            <!-- 活動標題 -->
            <h1 id="party-title">{{.ActivityModel.ActivityName}}</h1>
            <!-- 跑馬燈 -->
            <div id="marquee">
                <div class="marquee-background-border"></div>
                <div class="marquee-background">
                    <div class="loudspeaker">
                        <img src="/admin/assets/partyscreen/lib/userinterface/volume-up-solid-01.svg" />
                    </div>
                    <div class="marquee-content">
                        <div class="marquee-content-box">
                            {{range $data := .ActivityModel.Message}}
                                <span>{{$data}}</span>
                            {{end}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 聊天頁區塊 -->
        <div id="message-container" class="chatroom-page">
            <div id="normal-message-block">
                <div class="normal-message-movebox"></div>
            </div>
        </div>

        <!-- 彈幕顯示區塊 -->
        <div id="barrage-container">
            <div id="normal-barrage-container" class="barrage-container">
                <div id="barrage-track-place" class="track-place"></div>
            </div>
            <div id="special-barrage-container" class="barrage-container"></div>
            <div id="occupy-barrage-container" class="barrage-container"></div>
        </div>

        <!-- 操作欄位區塊 -->
        <div id="control-bar">
            <div class="control-background"></div>
            <div class="control-toggle-area"></div>
            <div class="control-toggle-button"></div>
            <div class="page-button-area">
                <div class="page-view-area"></div>
                <div class="page-control-area">
                    <div class="prev-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 16 16">
                            <path d="m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                        </svg>
                    </div>
                    <div class="next-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                            <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="control-button-area">
                <div class="page-control-area"></div>
                <div style="margin-right: 0.8rem; width: 1px; height: 100%; background-color: #dfdfdf; z-index: 1;"></div>
                <div class="base-control-area">
                    <div class="button-box" data-name="barrage">
                        <div class="icon-box">
                            <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/barrage.png">
                            <img class="lock-img" src="/admin/assets/partyscreen/lib/userinterface/lock.png">
                        </div>
                        <div class="button-name">顯示彈幕</div>
                    </div>
                    <div class="button-box" data-name="screen">
                        <div class="icon-box">
                            <img class="icon-img toggle1" src="/admin/assets/partyscreen/lib/userinterface/full-screen.png">
                            <img class="icon-img toggle2" src="/admin/assets/partyscreen/lib/userinterface/shrink-screen.png">
                        </div>
                        <div class="button-name toggle1">全螢幕</div>
                        <div class="button-name toggle2">視窗化</div>
                    </div>
                    <div class="button-box" data-name="qrcode">
                        <div class="icon-box">
                            <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/QRcode.png">
                            <img class="lock-img" src="/admin/assets/partyscreen/lib/userinterface/lock.png">
                        </div>
                        <div class="button-name">QRcode</div>
                    </div>
                    <div class="button-box" data-name="voice">
                        <div class="range-box close">
                            <input type="range" value="100" min="0" max="100" step="1">
                            <span>100</span>
                        </div>
                        <div class="icon-box">
                            <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/voice.png">
                            <img class="lock-img" src="/admin/assets/partyscreen/lib/userinterface/lock.png">
                        </div>
                        <div class="button-name">背景音</div>
                    </div>
                    <div class="button-box" data-name="help">
                        <div class="icon-box">
                            <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/help.png">
                        </div>
                        <div class="button-name">幫助</div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- 操作訊息與提示區塊 -->
        <div id="info-tip-container">
            <div class="introduce-toggle-button-box">
                <div class="close-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </div>
                <button id="area-button" class="introduce-toggle-button focus">
                    <img class="default" src="/admin/assets/partyscreen/lib/userinterface/area-button.png" alt="區塊介紹" />
                    <img class="focus" src="/admin/assets/partyscreen/lib/userinterface/area-button-focus.png" alt="區塊介紹-目前" />
                </button>
                <button id="hotkey-button" class="introduce-toggle-button">
                    <img class="default" src="/admin/assets/partyscreen/lib/userinterface/hotkey-button.png" alt="快捷鍵" />
                    <img class="focus" src="/admin/assets/partyscreen/lib/userinterface/hotkey-button-focus.png" alt="快捷鍵-目前" />
                </button>
            </div>
            <div id="hotkey-introduce" class="introduce-box">
                <div class="hotkey-picture">
                    <img src="/admin/assets/partyscreen/lib/userinterface/hotkey.svg" />
                </div>
            </div>
            <div id="area-introduce" class="introduce-box open">
                <div class="text-introduce">
                    <div class="text-area show" data-name="page">
                        <h5>互動頁面選擇</h5>
                        <ol>
                            <li>此區塊為本場活動可用的互動項目</li>
                            <li>可以點擊下方按鈕來切換互動頁面</li>
                            <li>因畫面寬度有限，右邊箭頭按鈕可切換至其他互動頁面按鈕</li>
                        </ol>
                    </div>
                    <div class="text-area" data-name="control">
                        <h5>互動頁面操作</h5>
                        <ol>
                            <li>此區塊為該互動頁面可使用的操作</li>
                            <li>部分互動頁面無操作按鈕</li>
                        </ol>
                    </div>
                    <div class="text-area" data-name="setting">
                        <h5>功能設置</h5>
                        <ol>
                            <li>此區塊為本場活動的設定區塊，能在所有互動頁面中進行設定調整</li>
                            <li>全螢幕或視窗化的切換（建議活動進行時切換為全螢幕）</li>
                            <li>QRcode和彈幕的「顯示/隱藏」切換</li>
                            <li>互動頁面的音量調整</li>
                        </ol>
                    </div>
                </div>
                <div class="page-area focus-area show" data-name="page">
                    <div class="sign"></div>
                </div>
                <div class="control-area focus-area" data-name="control">
                    <div class="sign"></div>
                </div>
                <div class="setting-area focus-area" data-name="setting">
                    <div class="sign"></div>
                </div>
            </div>
        </div>

        <!-- 一般彈幕樣式 -->
        <div id="normal-barrage-style">
            <template id="barrage-style1-template">
                <div class="normal-barrage style-default">
                    <div class="content-block">
                        <div class="avatar-block">
                            <img class="avatar-img" src="/admin/assets/dist/img/default-avatar.png">
                            <img class="avatar-border" src="/admin/assets/partyscreen/lib/normalbarrage/default/avatar-border.png">
                        </div>
                        <div class="barrage-background">
                            <div class="message-box">
                                <div class="message-name"></div>
                                <div class="message-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
            <template id="barrage-style2-template">
                <div class="normal-barrage style-text">
                    <div class="content-block">
                        <div class="avatar-block">
                            <img class="avatar-img" src="/admin/assets/dist/img/default-avatar.png">
                            <img class="avatar-border" src="/admin/assets/partyscreen/lib/normalbarrage/default/avatar-border.png">
                        </div>
                        <div class="barrage-background">
                            <div class="message-box">
                                <div class="message-name"></div>
                                <div class="message-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- 一般訊息模板 -->
        <template id="normal-message-default">
            <div class="normal-message normal-message-default">
                <div class="background">
                    <img src="/admin/assets/partyscreen/lib/normalmessage/default/right.svg">
                </div>
                <div class="content">
                    <div class="avatar-box">
                        <img class="avatar-img">
                        <img class="avatar-border" src="/admin/assets/partyscreen/lib/normalmessage/default/avatar-border.png">
                    </div>
                    <div class="message-box">
                        <div class="message-name"></div>
                        <div class="message-text">
                            <span></span>
                        </div>
                    </div>
                    <div class="control-box">
                        <div class="open-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                                <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                            </svg>
                        </div>
                        <div class="close-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- 尚未建立遊戲提示區塊 No-Create-Game -->
        <div class="ncg-container">
            <div class="ncg-skin">
                <div class="ncg-picture">
                    <div class="svg-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-controller" viewBox="0 0 16 16">
                            <path d="M11.5 6.027a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-1.5 1.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1zm2.5-.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-1.5 1.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1zm-6.5-3h1v1h1v1h-1v1h-1v-1h-1v-1h1v-1z"/>
                            <path d="M3.051 3.26a.5.5 0 0 1 .354-.613l1.932-.518a.5.5 0 0 1 .62.39c.655-.079 1.35-.117 2.043-.117.72 0 1.443.041 2.12.126a.5.5 0 0 1 .622-.399l1.932.518a.5.5 0 0 1 .306.729c.14.09.266.19.373.297.408.408.78 1.05 1.095 1.772.32.733.599 1.591.805 2.466.206.875.34 1.78.364 2.606.024.816-.059 1.602-.328 2.21a1.42 1.42 0 0 1-1.445.83c-.636-.067-1.115-.394-1.513-.773-.245-.232-.496-.526-.739-.808-.126-.148-.25-.292-.368-.423-.728-.804-1.597-1.527-3.224-1.527-1.627 0-2.496.723-3.224 1.527-.119.131-.242.275-.368.423-.243.282-.494.575-.739.808-.398.38-.877.706-1.513.773a1.42 1.42 0 0 1-1.445-.83c-.27-.608-.352-1.395-.329-2.21.024-.826.16-1.73.365-2.606.206-.875.486-1.733.805-2.466.315-.722.687-1.364 1.094-1.772a2.34 2.34 0 0 1 .433-.335.504.504 0 0 1-.028-.079zm2.036.412c-.877.185-1.469.443-1.733.708-.276.276-.587.783-.885 1.465a13.748 13.748 0 0 0-.748 2.295 12.351 12.351 0 0 0-.339 2.406c-.022.755.062 1.368.243 1.776a.42.42 0 0 0 .426.24c.327-.034.61-.199.929-.502.212-.202.4-.423.615-.674.133-.156.276-.323.44-.504C4.861 9.969 5.978 9.027 8 9.027s3.139.942 3.965 1.855c.164.181.307.348.44.504.214.251.403.472.615.674.318.303.601.468.929.503a.42.42 0 0 0 .426-.241c.18-.408.265-1.02.243-1.776a12.354 12.354 0 0 0-.339-2.406 13.753 13.753 0 0 0-.748-2.295c-.298-.682-.61-1.19-.885-1.465-.264-.265-.856-.523-1.733-.708-.85-.179-1.877-.27-2.913-.27-1.036 0-2.063.091-2.913.27z"/>
                        </svg>
                    </div>
                </div>
                <div class="ncg-title">不好意思，您還尚未建立 [ <span class="game-name"></span> ] 遊戲場次喔</div>
                <a class="create-game-button" href="{{.Route.Activity}}" target="_blank">點我新增</a>
            </div>
        </div>

        <!-- QRcode操作區塊 -->
        <div id="qr-move-area">
            <div class="qr-box">
                <div class="qr-control-box">
                    <div class="qr-resizer">
                        <div class="resize-circle left-top-circle"></div>
                        <div class="resize-circle left-bottom-circle"></div>
                        <div class="resize-circle right-top-circle"></div>
                        <div class="resize-circle right-bottom-circle"></div>
                    </div>
                    <div class="qr-img"></div>
                </div>
                <div class="qr-title"></div>
            </div>
        </div>

        <!-- 背景音樂存放區塊 -->
        <div id="music-box"></div>
        

        <!-- 互動頁面模板 -->
        <template id="iframe-page-template">
            <div class="interactive-page">
                <div class="iframe-box">
                    <iframe frameborder="0" autoplay></iframe>
                </div>
            </div>
        </template>

        <!-- 聊天類型操作欄位模板 -->
        <template id="chatroom-control-template">
            <button class="button-box" data-name="first-page">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/start-page.png">
                </div>
                <div class="button-name">最前頁</div>
            </button>
            <button class="button-box" data-name="previous-page">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/previous.png">
                </div>
                <div class="button-name">上一頁</div>
            </button>
            <button class="button-box" data-name="play">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/play.png">
                </div>
                <div class="button-name">播放</div>
            </button>
            <button class="button-box" data-name="stop">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/stop.png">
                </div>
                <div class="button-name">暫停</div>
            </button>
            <button class="button-box" data-name="next-page">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/next.png">
                </div>
                <div class="button-name">下一頁</div>
            </button>
            <button class="button-box" data-name="last-page">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/end-page.png">
                </div>
                <div class="button-name">最後頁</div>
            </button>
        </template>

        <!-- 遊戲類型操作欄位模板 -->
        <template id="game-control-template">
            <div class="select-box" data-name="select-scene">
                <div class="select">
                    <select id="select-scene" class="select-hidden"></select>
                    <div class="custom-select">
                        <div class="select-styled">
                            <div class="icon-box">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 16 16">
                                    <path d="m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="select-options-box">
                            <ul class="select-options"></ul>
                        </div>
                    </div>
                </div>
                <div class="select-name">遊戲場次</div>
            </div>
        </template>

        <!-- 提問類型操作欄位模板 -->
        <template id="question-control-template">
            <div class="button-box" data-name="show-all">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/show-all.png">
                </div>
                <div class="button-name">查看全部</div>
            </div>
            <div class="button-box" data-name="show-like">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/show-like.png">
                </div>
                <div class="button-name">顯示已回答提問</div>
            </div>
            <div class="button-box" data-name="show-unlike">
                <div class="icon-box">
                    <img class="icon-img" src="/admin/assets/partyscreen/lib/userinterface/show-unlike.png">
                </div>
                <div class="button-name">顯示未回答提問</div>
            </div>
        </template>

        <!-- 頁面按鈕模板 -->
        <template id="page-button-template">
            <div class="button-box" data-type="page">
                <div class="icon-box">
                    <img class="icon-img">
                </div>
                <div class="button-name"></div>
            </div>
        </template>

        <div id="user-data" style="display: none;">{{.UserJSON}}</div>

    </body>
    <!--script src="/admin/assets/partyscreen/js/chatroom-system.js?ver="></script -->
    <!--script src="/admin/assets/partyscreen/js/danmu.js?ver="></script -->
    <!--script src="/admin/assets/partyscreen/js/blackList.min.js?ver="></script -->
    <script src="/admin/assets/partyscreen/js/chatroom.min.js?ver=HILIVES-202407081550"></script>
    <script src="/admin/assets/partyscreen/js/party-screen.js?ver=HILIVES-202407081550"></script>
    <script>

        setTimeout(function(){
            $("#loading-container").addClass("close")
        }, 2000)

        // window.partyBlackList_WS = new PartyBlackListWebSocket()

        localStorage.setItem("currentPage", "message")

        const userData = $("#user-data").text()
        let userJSON = JSON.parse(userData)
        const pagePath = userJSON["activity_menus"][partyID]

        fetch("https://"+ getAPIDomainFromURL() +"/v1/admin/overview").then(function(res){
            return res.json()
        }).then(function(res){
            overviewStatus(res.data)
        }).then(function(){
            loadPageButton()
            partyScreenUIControl()
        }).then(function(){
            webSocket_session()
        })

        function overviewStatus(data){
            const item = []
            const url = "/admin/interact/wall/"
            $(pageInfo).each(function(o){
                $(pagePath).each(function(e){
                    if(pagePath[e].substr(url.length) === pageInfo[o].name){
                        item.push({ "name": pageInfo[o].name, "status": pageInfo[o].status})
                    }
                }).promise().done(function(){
                    $(pagePath).each(function(e){
                        if(pagePath[e] === "*" || pagePath[e] === "admin"){

                        }else{
                            pageInfo[o].status = "close"
                        }
                    })
                })
            }).promise().done(function(){
                $(item).each(function(i){
                    $(pageInfo).each(function(o){
                        if(item[i].name === pageInfo[o].name){
                            pageInfo[o].status = item[i].status
                        }else if(pageInfo[o].name === "message"){
                            pageInfo[o].status = "open"
                        }
                    })
                })
            })
        }

    </script>
    <script>

        // partyScreenUIControl()
        // runMarquee()
        controlQRcode()
        createQRcode("{{.Route.ApplySign}}")

        loadInteractivePage()
        
        
        

        window.addEventListener('message', playBackgroundMusic, false)

        var loginRequired = "{{.ActivityModel.LoginRequired}}"
        var passwordRequired = "{{.ActivityModel.PasswordRequired}}"
        var loginPassword = "{{.ActivityModel.LoginPassword}}"
        var login = getKeyFromURL("login")

        if(login === "false"){
            if(loginRequired === "open"){
                const template = `
                    <div class="verification-container">
                        <div class="verification-skin">
                            <h3 class="verification-title">無法進入該頁面</h3>
                            <h6 class="verification-title">請開啟自定義密碼登入開關</h6>
                        </div>
                    </div>
                `
                $("body").append(template)
            }else if(loginRequired === "close"){
                if(passwordRequired === "open"){
                    const template = `
                        <div class="verification-container">
                            <div class="verification-skin">
                                <h3 class="verification-title">請輸入登入密碼</h3>
                                <p class="error-text">登入密碼錯誤</p>
                                <input type="password" placeholder="請輸入登入密碼">
                                <button class="confirm-button">確定</button>
                            </div>
                        </div>
                    `
                    $("body").append(template)

                    $(".verification-container").find(".confirm-button").bind("click", function(){
                        if($(".verification-container").find("input[type=password]").val() === loginPassword){
                            $(".verification-container").find(".error-text").removeClass("open")
                            $(".verification-container").remove()
                        }else{
                            $(".verification-container").find(".error-text").addClass("open")
                        }
                    })
                }else{

                }
                
            }
        }




        let time = new Date().getTime()
        let randomCode_name = ""
        for(let i = 0; i < 10; i++){
            randomCode_name += getRandomChar()
        }
        let code = time + randomCode_name

        sessionStorage.setItem("Hilives-code", code)

        let ws_session
        let ws_session_reconnect = false
        
        messageControl()

        function reconnectWebsocket_session(){
            if(ws_session_reconnect){ return }
            ws_session_reconnect = true
            setTimeout(function(){
                websocketHeartbeat_session()
                ws_session_reconnect = false
            }, 2000)
        }

        function websocketHeartbeat_session(){
            try{
                if("WebSocket" in window){
                    webSocket_session()
                }else{
                    alert("很抱歉，您的裝置無法支援WebSocket相關功能。")
                }
            }catch(e){
                reconnectWebsocket_session()
                alert("控制連線發生異常，請重新整理網頁，如無法排除問題，請聯絡技術專員。")
                console.log(e)
            }
        }

        function webSocket_session(){
            const url = "wss://"+ getAPIDomainFromURL() +"/ws/v1/host/control?activity_id="+ getKeyFromURL("activity_id") +"&device=pc&session_id="+ sessionStorage.getItem("Hilives-code")
            
            ws_session = new WebSocket(url)

            ws_session.onopen = function(){
                console.log("ws_session開啟")
                send_sessionID()
            }

            ws_session.onerror = function(error){
                alert("ws_session錯誤，代碼: " + error.code, error.reason)
            }

            ws_session.onclose = function(error){
                console.log("ws_session關閉，代碼: " + error.code, error.reason)

                if(error.code !== 1000){
                    alert("ws_session重新啟動中...")
                    history.go(0)
                    reconnectWebsocket_session()
                }else{
                    console.log("ws_session已正常關閉")
                }
            }

            ws_session.onmessage = function(e){
                const data = JSON.parse(e.data) //接收ws檔案
                
                const currentPage = localStorage.getItem("currentPage") //取得舊的頁面的名稱
                if(data.page === ""){
                    localStorage.setItem("currentPage", currentPage) //用ws檔案設置新的頁面的名稱
                }else{
                    localStorage.setItem("currentPage", data.page) //用ws檔案設置新的頁面的名稱
                }
                const differentPage = localStorage.getItem("currentPage") //取得新的頁面的名稱
                if(currentPage !== differentPage){ //如果舊的頁面名稱 不等於 新的頁面的名稱
                    loadInteractivePage() //執行載入新的互動頁面
                }

                const actionData = data.action //取得ws檔案的action值
                if(actionData.indexOf("setting-") == 0){ //如果是大螢幕設置相關action的話(聲音、彈幕、QRcode)
                    const setting = data.action
                    controlSetting(setting)
                }else{ //如果不是大螢幕設置相關action的話
                    const _index = actionData.indexOf("_")
                    const action = actionData.substr(0,  _index) //取得處裡亂碼後的action值
                    controlPartyGame(differentPage, action, data.Game.game_id_2) //執行換頁或上下場的切換
                }
            }

            selectGameSceneControl()
            pageButtonsControl()
            settingsButtonsControl()
        }

        function selectGameSceneControl(){
            // $("#page-control").find(".select-button ")
        }

        function pageButtonsControl(){
            $(".page-view-area").find(".button-box").bind("click", function(){
                const page = $(this).data("name")
                const objectJSON = { page: page, action: "" }
                ws_session.send(JSON.stringify(objectJSON))
            })
        }

        function settingsButtonsControl(){
            $(".base-control-area").find(".button-box").bind("click", function(){
                const action = $(this).data("name")
                let i
                if($(this).hasClass("lock")){
                    i = "close"
                }else{
                    i = "open"
                }

                if(action === "barrage"){
                    const objectJSON = { page: "", action: "setting-danmu-"+ i }
                    ws_session.send(JSON.stringify(objectJSON))
                }else if(action === "qrcode"){
                    const objectJSON = { page: "", action: "setting-qrcode-"+ i }
                    ws_session.send(JSON.stringify(objectJSON))
                }else if(action === "voice"){
                    const objectJSON = { page: "", action: "setting-music-"+ i }
                    ws_session.send(JSON.stringify(objectJSON))
                }
            })
        }

        function controlSetting(setting){
            if(setting === "setting-qrcode-open"){
                $(".button-box[data-name=qrcode]").removeClass("lock")
                $("#qr-move-area").removeClass("close")
            }else if(setting === "setting-qrcode-close"){
                $(".button-box[data-name=qrcode]").addClass("lock")
                $("#qr-move-area").addClass("close")
            }

            // if(setting === "setting-music-open"){
            //     $(".button-box[data-name=voice]").removeClass("lock")

                // $("#music-box").empty()
                // var src = `/admin/assets/partyscreen/music/ropepack_end.mp3`
                // $("#music-box").append("<audio src='"+ src +"' loop></audio>")
                // $("#music-box").find("audio").get(0).volume = 0.3
                // $("#music-box").find("audio").get(0).play()

            // }else if(setting === "setting-music-close"){
            //     $(".button-box[data-name=voice]").addClass("lock")
            //     $("#music-box").find("audio").get(0).volume = 0
            // }

            // if(setting === "setting-screen-open"){
            //     $(".button-box[data-name=screen]").removeClass("toggle")
            //     console.log(document.fullscreenEnabled)
            //     console.log(document.fullscreen)
            //     $("html").get(0).requestFullscreen()
            // }else if(setting === "setting-screen-close"){
            //     $(".button-box[data-name=screen]").addClass("toggle")
            //     document.exitFullscreen()
            // }

            if(setting === "setting-danmu-open"){
                $(".button-box[data-name=barrage]").removeClass("lock")
                $("#barrage-container").removeClass("close")
            }else if(setting === "setting-danmu-close"){
                $(".button-box[data-name=barrage]").addClass("lock")
                $("#barrage-container").addClass("close")
            }
        }

        const shakeredpack = pageSetting.shakeredpack
        const shakeredpack_iframeUrl = shakeredpack.iframeurl
        const shakeredpack_qrcodeUrl = shakeredpack.qrurl

        const clickredpack = pageSetting.clickredpack
        const clickredpack_iframeUrl = clickredpack.iframeurl
        const clickredpack_qrcodeUrl = clickredpack.qrurl

        const whackamole = pageSetting.whackamole
        const whackamole_iframeUrl = whackamole.iframeurl
        const whackamole_qrcodeUrl = whackamole.qrurl

        const monopoly = pageSetting.monopoly
        const monopoly_iframeUrl = monopoly.iframeurl
        const monopoly_qrcodeUrl = monopoly.qrurl

        const drawnumbers = pageSetting.drawnumbers
        const drawnumbers_iframeUrl = drawnumbers.iframeurl
        const drawnumbers_qrcodeUrl = drawnumbers.qrurl

        const lottery = pageSetting.lottery
        const lottery_iframeUrl = lottery.iframeurl
        const lottery_qrcodeUrl = lottery.qrurl

        const QandA = pageSetting.QandA
        const QandA_iframeUrl = QandA.iframeurl
        const QandA_qrcodeUrl = QandA.qrurl

        const tugofwar = pageSetting.tugofwar
        const tugofwar_iframeUrl = tugofwar.iframeurl
        const tugofwar_qrcodeUrl = tugofwar.qrurl

        const bingo = pageSetting.bingo
        const bingo_iframeUrl = bingo.iframeurl
        const bingo_qrcodeUrl = bingo.qrurl

        function messageControl(){
            $(".page-control-area").find(".button-box").bind("click", function(){
                const name = $(this).data("name")
                if(name === "play"){
                    const objectJSON = { page: "", action: "message-play" }
                    ws_session.send(JSON.stringify(objectJSON))
                }else if(name === "stop"){
                    const objectJSON = { page: "", action: "message-stop" }
                    ws_session.send(JSON.stringify(objectJSON))
                }
            })
        }

        function controlPartyGame(currentPage, action, gameID2){
            if(currentPage === "message"){
                removeBGM()
                if(action === "first-page"){
                    loadFirstPageMessage()
                    messageButtonAnimation()
                    stopMessageAnimation()
                    startMessageAnimation()
                }else if(action === "prev-page"){
                    loadPrevPageMessage()
                    messageButtonAnimation()
                    stopMessageAnimation()
                    startMessageAnimation()
                }else if(action === "play"){
                    startMessageAnimation()
                    $(".button-box[data-name=play]").addClass("close")
                    $(".button-box[data-name=stop]").removeClass("close")
                }else if(action === "stop"){
                    stopMessageAnimation()
                    $(".button-box[data-name=play]").removeClass("close")
                    $(".button-box[data-name=stop]").addClass("close")
                }else if(action === "next-page"){
                    loadNextPageMessage()
                    messageButtonAnimation()
                    stopMessageAnimation()
                    startMessageAnimation()
                }else if(action === "last-page"){
                    loadLastPageMessage()
                    messageButtonAnimation()
                    stopMessageAnimation()
                    startMessageAnimation()
                }
            }else if(currentPage === "question"){
                removeBGM()
                const questionIframe = $("#question-page").find("iframe").get(0).contentWindow
                if(action === "view-all"){
                    questionIframe.postMessage("all", "https://" + location.host)
                }else if(action === "view-like"){
                    questionIframe.postMessage("like", "https://" + location.host)
                }else if(action === "view-unlike"){
                    questionIframe.postMessage("unlike", "https://" + location.host)
                }
            }else if(currentPage === "redpack"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, shakeredpack_iframeUrl, shakeredpack_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "ropepack"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, clickredpack_iframeUrl, clickredpack_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "whack_mole"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, whackamole_iframeUrl, whackamole_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "monopoly"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, monopoly_iframeUrl, monopoly_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "draw_numbers"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, drawnumbers_iframeUrl, drawnumbers_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "lottery"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, lottery_iframeUrl, lottery_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "QA"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, QandA_iframeUrl, QandA_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "tugofwar"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, tugofwar_iframeUrl, tugofwar_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else if(currentPage === "bingo"){
                if(action === "selectScene"){
                    loadGameScene(gameID2, bingo_iframeUrl, bingo_qrcodeUrl)
                    changeGameSelectControl(gameID2)
                }
            }else{
                removeBGM()
            }
        }

        function changeGameSelectControl(gameID2){
            $(".select-options").find("li.selected").removeClass("selected")
		    $(".select-options").find(`li[rel=${gameID2}]`).addClass("selected")
            $("select").val(gameID2)
            $("select").next(".custom-select").children(".select-styled").find("p").text($(".select-options").find("li.selected").text())
        }


        function send_sessionID(){
            ws_session.send(JSON.stringify({
                activity_id: getKeyFromURL("activity_id"), 
                device: "pc",
                control_id: sessionStorage.getItem("Hilives-code")
            }))
            document.title = sessionStorage.getItem("Hilives-code")
        }

        function getRandomChar() {
            let n = Math.floor(Math.random() * 62)
            if(n < 10){ return n }
            if(n < 36){ return String.fromCharCode(n + 55) }
            return String.fromCharCode(n + 61)
        }

    </script>
    <script>
        window.onload = function() {
            const script = document.getElementsByTagName("script")
            for (let i = 0; i < script.length; i++) {
                let src = script[i].src
                if (src.includes("?ver=")) {
                    let timestamp = Date.now()
                    script[i].src = src + "?ver=HILIVES-" + timestamp
                }
            }
        }
    </script>
</html>